% \VignetteIndexEntry{dimension Manual}
% \VignetteDepends{dimension}
% \VignettePackage{dimension}
\documentclass[12pt]{article}
\usepackage{amsmath}
\usepackage[pdftex]{graphicx}
\usepackage{float}
\usepackage{subfig}
\usepackage{color}
\usepackage{xspace}
\usepackage{fancyvrb}
\usepackage{fancyhdr}
\usepackage[
     colorlinks=true,
     linkcolor=blue,
     citecolor=blue,
     urlcolor=blue]
     {hyperref}
\usepackage{lscape}
\usepackage{Sweave}
\usepackage{tabularx}
\usepackage{listings}
\usepackage{mdwlist}
\usepackage{indentfirst}
\newcommand{\SubItem}[1]{
    {\setlength\itemindent{15pt} \item[-] #1}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% define new colors for use
\definecolor{darkgreen}{rgb}{0,0.6,0}
\definecolor{darkred}{rgb}{0.6,0.0,0}
\definecolor{lightbrown}{rgb}{1,0.9,0.8}
\definecolor{brown}{rgb}{0.6,0.3,0.3}
\definecolor{darkblue}{rgb}{0,0,0.8}
\definecolor{darkmagenta}{rgb}{0.5,0,0.5}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\bld}[1]{\mbox{\boldmath $#1$}}
\newcommand{\shell}[1]{\mbox{$#1$}}
\renewcommand{\vec}[1]{\mbox{\bf {#1}}}
\newcommand{\ReallySmallSpacing}{\renewcommand{\baselinestretch}{.6}\Large\normalsize}
\newcommand{\SmallSpacing}{\renewcommand{\baselinestretch}{1.1}\Large\normalsize}
\def\tm{\leavevmode\hbox{$\rm {}^{TM}$}}

\newcommand{\R}{{\mathbf R}}
\newcommand{\brho}{{\color{blue}{\rho}}}
\newcommand{\Ra}{{\mathcal R}}
\newcommand{\PP}{{\mathbf P}}
\newcommand{\N}{{\mathbf N}}
\newcommand{\K}{{\mathcal K}}

\setlength{\oddsidemargin}{-.25 truein}
\setlength{\evensidemargin}{0truein}
\setlength{\topmargin}{-0.2truein}
\setlength{\textwidth}{7 truein}
\setlength{\textheight}{8.5 truein}
\setlength{\parindent}{0.20truein}
\setlength{\parskip}{0.10truein}

%Picture inclusion

\newcommand{\pic}[4]{
\begin{figure}[H]
\centering
\includegraphics[width=#1\textwidth]{#2}
\caption{#3}
\label{#4}
\end{figure}
}
\newcommand{\sidepic}[8]{
\begin{figure}[H]%
    \centering
    \subfloat[#1]{{\includegraphics[width=#2cm]{#3} }}%#3 for file 1
    \qquad
    \subfloat[#4]{{\includegraphics[width=#5cm]{#6} }}%
    \caption{#7}%
    \label{#8}%
\end{figure}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\pagestyle{fancy}
\lhead{}
\chead{The {\tt dimension} Package}
\rhead{}
\lfoot{}
\cfoot{}
\rfoot{\thepage}
\renewcommand{\headrulewidth}{1pt}
\renewcommand{\footrulewidth}{1pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{The {\tt dimension} Package}
\author{Wenlan Zang \\
wenlan.zang@yale.edu,
\\[6pt]
Jen-hwa Chu \\
jen-hwa.chu@yale.edu,
\\[6pt]
Michael J. Kane \\
michael.kane@yale.edu
}

\begin{document}
\input{dimension_manual-concordance}

\maketitle

\thispagestyle{empty}

\section{Introduction}

The {\tt dimension} package provides an efficient way to determine the dimension of a signal rich subspace in a large matrix. It also provides a cleaned estimator of the original matrix and correlation matrix. Source code is maintained at \href{https://github.com/WenlanzZ/dimension}{https://github.com/WenlanzZ/dimension}.

The {\tt dimension} package estimates the intrinsic dimension of a signal-rich subspace in large matrix ``real- and complex value dense R matrices and real-valued saprse matrices from the {\tt Matrix} package") by decomposing matrix into a signal-plus-noise space and approximate the signal-rich subspace with a rank $K$ approximation $\hat{X}=\sum_{k=1}^{K}d_ku_k{v_k}^T$. To estimate rank $K$, it follows a simple procedure assuming that matrix $X$ is composed of a low-rank signal matrix $S$ and an average general noise random matrix $\bar{N}$. It has been shown that the average eigenvalues of random matrices $N$ follows a universal Marc\u{e}nko-Pastur (MP) distribution. We hypothesize that the deviation of eigenvalues of $X$ from the MP distribution indicates the intrinsic dimension of signal-rich subspace.

The package included the following main functions:
\begin{itemize}
\item{subspace() - Greate a subspace class with scaled eigenvalue and eigenvectors and simulated noise eigenvalues for specified ranks.}
\item{print.subspace()- Get a brief summary of subspace class.}
\item{plot.subspace() - Get the scree plot of subspace class.}
\item{dimension() - Get the dimension of a signal-subspace in a large high-dimensional matrix.}
\item{clipped() - Get a cleaned estimator of the original matrix, its covairance matrix and correlation matrix.}
\item{modified\_legacyplot() - Produces modified summary plots of bcp() output.}
\end{itemize}

A demostration of the main functions and with a brief sample is as follow.

\section{Subspace}

Let $X\in\R^{n\times p}$ be a simulated multivariate normal matrix with $ncc$ correlated columns.

\lstset{columns=flexible, basicstyle={\ttfamily\slshape}}
\begin{lstlisting}
> library('dimension')
> X <- Xsim(n = 150, p = 100, ncc = 30, var = c(rep(10,5),rep(3,25)))
> t1 <- proc.time()
> Subspace <- subspace(X, rank = 1:50, times = 10,  basis = "eigen")
> print(proc.time() - t1)
   user  system elapsed
  0.946   0.293   0.767
> gc()
  used  (Mb)    gc      trigger  (Mb) limit (Mb)  max used  (Mb)
Ncells  9590962 512.3   17937651 958.0         NA 16475288 879.9
Vcells 16208511 123.7   27151251 207.2      16384 22559284 172.2
> plot(Subspace, annotation = 30)
\end{lstlisting}
\pic{0.7}{{"Subspace_1_50_Scree"}.pdf}{}{Figure 1}

\begin{lstlisting}
> t1 <- proc.time()
> results  <- dimension(subspace_ = Subspace)
# equivelantly, if subsapce has not been calcualted
> results <- dimension(X, rank = 1:50, times = 10, basis="eigen")
> print(proc.time() - t1)
   user  system elapsed
  0.125   0.014  10.654
> gc()
 used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
Ncells  9403721 502.3   17937651 958.0         NA 17937651 958.0
Vcells 15834973 120.9   27151251 207.2      16384 22559284 172.2
> str(results)
> plot(results$Subspace,
       Changepoint = results$Changepoint$dimension,
       annotation = 30)
\end{lstlisting}

\begin{lstlisting}
> modified_legacyplot(results$Changepoint$bcp_irl, annotation = 50)
> modified_legacyplot(results$Changepoint$bcp_post, annotation = 50)
\end{lstlisting}
\sidepic{label 1}{7}{{"Subspace_1_50_bcp_irl"}.pdf}{label 2}{7}{{"Subspace_1_50_bcp_post"}.pdf}{bcp}{Figure 3}

\begin{lstlisting}
> t1 <- proc.time()
> TopSubspace <- subspace(X, rank = 1:5, times = 10,  basis = "eigen")
> TopSubspace
  An object of class subspace within  X matrix with 150 samples and 100 features.
  Estimated rank range from  1  to  5
> MidSubspace <- subspace(X, rank = 6:40, times = 10,  basis = "eigen")
  An object of class subspace within  X matrix with 150 samples and 100 features.
  Estimated rank range from  6  to  40
> print(proc.time() - t1)
   user  system elapsed
  0.974   0.292   0.788
> gc()
  used  (Mb) gc trigger  (Mb) limit (Mb) max used  (Mb)
Ncells  9604856 513.0   17937651 958.0         NA 17937651 958.0
Vcells 16231491 123.9   27151251 207.2      16384 22559284 172.2
> plot(TopSubspace, Changepoint = results$Changepoint$dimension, annotation = 5)
> plot(MidSubspace, Changepoint = results$Changepoint$dimension, annotation = 40)
\end{lstlisting}
\sidepic{label 1}{7}{{"Subspace_1_5_Scree"}.pdf}{label 2}{7}{{"Subspace_6_40_Scree"}.pdf}{bcp}{Figure 3}

\end{document}
